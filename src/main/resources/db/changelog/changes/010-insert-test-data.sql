--liquibase formatted sql

--changeset myblog:010-insert-test-data
--preconditions onFail:MARK_RAN
--precondition-sql-check expectedResult:0 SELECT count(*) FROM users

-- Вставка тестовых пользователей
INSERT INTO users (username, email, display_name, bio) VALUES 
('admin', 'admin@myblog.com', 'Администратор', 'Главный администратор блога'),
('alice_writer', 'alice@example.com', 'Алиса Писатель', 'Люблю писать о путешествиях и кулинарии'),
('bob_reviewer', 'bob@example.com', 'Боб Рецензент', 'Пишу обзоры книг и фильмов'),
('charlie_tech', 'charlie@example.com', 'Чарли Техник', 'Разработчик и энтузиаст технологий');

-- Вставка тестовых тегов
INSERT INTO tags (name, description) VALUES 
('путешествия', 'Статьи о путешествиях по миру'),
('италия', 'Все о прекрасной Италии'),
('еда', 'Кулинарные рецепты и обзоры'),
('технологии', 'Новости и статьи о технологиях'),
('java', 'Программирование на Java'),
('spring', 'Spring Framework'),
('книги', 'Обзоры и рецензии книг'),
('фильмы', 'Обзоры фильмов и сериалов'),
('lifestyle', 'Образ жизни'),
('фотография', 'Искусство фотографии');

-- Вставка тестовых постов
INSERT INTO posts (title, content, is_published, published_at, author_id) VALUES 
(
    'Мое путешествие в Италию: Рим и его чудеса',
    'Италия — это страна, которая покоряет с первого взгляда. Во время моей недавней поездки в Рим я открыл для себя невероятную красоту Вечного города. Колизей поражает своим величием, а Ватикан — духовной силой. Но больше всего меня впечатлила итальянская кухня: настоящая паста карбонара, свежая моцарелла и божественный тирамису. Прогулки по узким улочкам Трастевере под вечерними огнями стали незабываемыми моментами этого путешествия.',
    true,
    CURRENT_TIMESTAMP - INTERVAL '5 days',
    2
),
(
    'Лучшие рецепты итальянской пасты для домашней кухни',
    'Итальянская кухня славится своей простотой и качеством ингредиентов. Сегодня я хочу поделиться секретами приготовления идеальной пасты дома. Первое правило — используйте качественную муку durum. Второе — не переваривайте пасту, она должна быть al dente. Для карбонары вам понадобится гуанчале, яйца, пекорино романо и черный перец. Никаких сливок! Это классический рецепт, передающийся из поколения в поколение.',
    true,
    CURRENT_TIMESTAMP - INTERVAL '3 days',
    2
),
(
    'Обзор: Spring Boot 3.0 и его новые возможности',
    'Spring Boot 3.0 принес множество новшеств в мир Java разработки. Основанный на Spring Framework 6.0, он поддерживает Java 17+ и GraalVM native compilation. Новые возможности включают улучшенную производительность, лучшую интеграцию с облачными платформами и поддержку Jakarta EE 9+. Миграция может потребовать некоторых усилий, но преимущества того стоят. В этой статье я рассмотрю ключевые изменения и дам практические советы по миграции.',
    true,
    CURRENT_TIMESTAMP - INTERVAL '1 day',
    4
),
(
    'Рецензия: "Чистый код" Роберта Мартина',
    '"Чистый код" — это не просто книга о программировании, это философия разработки. Роберт Мартин (дядя Боб) представляет принципы, которые помогают писать код, понятный не только компьютеру, но и другим разработчикам. Книга полна практических примеров и рефакторинга реального кода. Особенно ценными я считаю главы о именовании переменных и функций, а также о структуре классов. Обязательна к прочтению всем разработчикам.',
    true,
    CURRENT_TIMESTAMP - INTERVAL '2 days',
    3
),
(
    'Черновик: Планы на летние каникулы',
    'Это черновик поста о планах на лето. Хочу съездить в Грецию, изучить фотографию и попробовать новые рецепты. Пока это только идеи, которые нужно развить...',
    false,
    NULL,
    2
);

-- Связывание постов с тегами
INSERT INTO post_tags (post_id, tag_id) VALUES 
-- Пост "Мое путешествие в Италию" связан с тегами: путешествия, италия, еда
(1, 1), (1, 2), (1, 3),
-- Пост "Лучшие рецепты итальянской пасты" связан с тегами: еда, италия
(2, 3), (2, 2),
-- Пост "Обзор: Spring Boot 3.0" связан с тегами: технологии, java, spring
(3, 4), (3, 5), (3, 6),
-- Пост "Рецензия: "Чистый код"" связан с тегами: книги, технологии, java
(4, 7), (4, 4), (4, 5);

-- Обновление счетчиков использования тегов
UPDATE tags SET usage_count = (
    SELECT COUNT(*) FROM post_tags WHERE tag_id = tags.id
);

-- Вставка тестовых комментариев
INSERT INTO comments (content, author_id, post_id) VALUES 
('Отличная статья! Италия действительно прекрасная страна. Я тоже был в Риме в прошлом году.', 3, 1),
('Спасибо за рецепт карбонары! Обязательно попробую приготовить дома.', 4, 2),
('Согласен, что без сливок — это правильно. Настоящая карбонара должна быть именно такой.', 1, 2),
('Хорошая рецензия на Spring Boot 3.0. Мы как раз планируем миграцию в команде.', 3, 3),
('Роберт Мартин — мой любимый автор. "Чистый код" изменил мой подход к программированию.', 4, 4),
('Полностью согласен! Эта книга должна быть настольной для каждого разработчика.', 2, 4);

-- Вставка тестовых лайков
INSERT INTO likes (user_id, post_id) VALUES 
(1, 1), (3, 1), (4, 1),  -- 3 лайка для поста об Италии
(1, 2), (4, 2),          -- 2 лайка для поста о пасте
(2, 3), (3, 3),          -- 2 лайка для поста о Spring Boot
(1, 4), (2, 4), (4, 4);  -- 3 лайка для рецензии на книгу

--rollback DELETE FROM likes; DELETE FROM comments; DELETE FROM post_tags; DELETE FROM posts; DELETE FROM tags; DELETE FROM users;